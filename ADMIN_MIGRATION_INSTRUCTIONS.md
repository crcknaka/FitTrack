# Инструкция по применению миграции для админ-роли

## Что было сделано:

### 1. База данных
- Добавлено поле `is_admin` в таблицу `profiles`
- Установлен флаг `is_admin = true` для пользователя с ID `52d6f439-65c2-43be-b93b-3bce58744755`
- Обновлены RLS политики для таблиц `profiles`, `workouts` и `workout_sets`
- Теперь админ может видеть все профили, тренировки и сеты всех пользователей

### 2. Frontend
- Селектор пользователей на странице "Тренировки" теперь виден только админам
- Обычные пользователи не увидят возможность просматривать чужие тренировки
- Обновлены TypeScript типы для поддержки поля `is_admin`

## Как применить миграцию:

### Вариант 1: Через Supabase Dashboard (Рекомендуется)

1. Откройте Supabase Dashboard: https://supabase.com/dashboard
2. Выберите ваш проект
3. Перейдите в раздел **SQL Editor**
4. Скопируйте содержимое файла `supabase/migrations/20260111000000_add_admin_role.sql`
5. Вставьте в редактор и нажмите **Run**

### Вариант 2: Через Supabase CLI (если настроен)

```bash
npx supabase db push
```

## Проверка после применения:

1. Откройте приложение и войдите под админом (iljacrc@gmail.com)
2. Перейдите на страницу "Тренировки"
3. Вы должны увидеть селектор выбора пользователей (справа вверху)
4. Войдите под другим пользователем - селектора не должно быть

## Что изменилось для пользователей:

### Для админа (iljacrc@gmail.com):
- ✅ Видит селектор всех пользователей на странице "Тренировки"
- ✅ Может просматривать тренировки любого пользователя
- ✅ Может просматривать профили всех пользователей

### Для обычных пользователей:
- ❌ НЕ видят селектор пользователей
- ❌ НЕ могут просматривать чужие тренировки через UI
- ✅ Видят только свои тренировки

## Файлы, которые были изменены:

1. `supabase/migrations/20260111000000_add_admin_role.sql` - новая миграция
2. `src/hooks/useProfile.ts` - добавлено поле `is_admin` в интерфейс Profile
3. `src/hooks/useAllProfiles.ts` - добавлено поле `is_admin` в интерфейс UserProfile
4. `src/pages/Workouts.tsx` - селектор пользователей теперь условно рендерится только для админов

## Важно:

- Функциональность шаринга (публичные ссылки) осталась без изменений
- RLS политики защищают данные на уровне базы данных
- Даже если кто-то попытается обойти фронтенд, база данных не вернет чужие данные
