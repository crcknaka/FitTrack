# Функция "Избранные упражнения"

## Что добавлено

1. **База данных**: Новая таблица `favorite_exercises` для хранения избранных упражнений пользователей
2. **UI**:
   - Две вкладки "Все" / "Избранные" при выборе упражнения
   - Кнопка-звёздочка на каждом упражнении (в правом верхнем углу)
   - Жёлтая заполненная звезда = в избранном
   - Серая пустая звезда = не в избранном
3. **Функциональность**:
   - Клик по звезде добавляет/удаляет упражнение из избранного
   - Оптимистичные обновления - UI меняется мгновенно
   - Синхронизация между устройствами
   - Работает для preset и пользовательских упражнений

## Как применить миграцию

1. Открой [Supabase Dashboard](https://supabase.com/dashboard)
2. Выбери свой проект Reppy
3. Перейди в раздел **SQL Editor**
4. Создай новый запрос
5. Скопируй содержимое файла `APPLY_FAVORITE_EXERCISES_MIGRATION.sql`
6. Вставь в SQL Editor
7. Нажми **Run** (или F5)
8. Проверь что выполнилось успешно (зелёная галочка)

## Архитектура

### База данных
```sql
favorite_exercises (
  id UUID,
  user_id UUID -> profiles(user_id),
  exercise_id UUID -> exercises(id),
  created_at TIMESTAMP,
  UNIQUE(user_id, exercise_id)
)
```

### React Query кэш
- Данные загружаются один раз при входе
- Хранятся как `Set<string>` для O(1) lookup
- Автоматически обновляются при изменениях

### Оптимистичные обновления
1. Клик по звезде → UI обновляется сразу
2. Запрос отправляется на сервер
3. Если ошибка → откатываем UI
4. Если успех → синхронизируем с сервером

## Файлы изменены

1. `supabase/migrations/20260110100000_add_favorite_exercises.sql` - миграция БД
2. `src/integrations/supabase/types.ts` - TypeScript типы для новой таблицы
3. `src/hooks/useFavoriteExercises.ts` - новый хук для работы с избранными
4. `src/pages/WorkoutDetail.tsx` - обновлён UI диалога выбора упражнений

## Производительность

- **Запрос избранных**: 1 раз при загрузке приложения
- **Lookup избранного**: O(1) через Set
- **Обновление UI**: мгновенное (оптимистичное)
- **Сетевой запрос**: асинхронный, не блокирует UI

## Будущие улучшения (опционально)

- Сортировка избранных по частоте использования
- Быстрое добавление в избранное прямо со страницы упражнений
- Статистика популярных упражнений
